<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Theme Wordle</title>

<style>
body {
  background:#121212;
  color:#fff;
  font-family:system-ui;
  margin:0;
  padding:16px;
}
.app {
  max-width:420px;
  margin:auto;
}
h1 { text-align:center; margin-bottom:8px; }

.hint {
  background:#1e1e1e;
  padding:14px;
  border-radius:10px;
  text-align:center;
  margin-bottom:16px;
  font-size:1.1rem;
}

#timerLine { font-weight:600; margin-bottom:6px; }
#themeLine { opacity:0.9; font-size:1rem; }

.board {
  display:grid;
  gap:10px;
  margin-bottom:16px;
}
.row {
  display:grid;
  gap:8px;
}
.cell {
  background:#1e1e1e;
  border:2px solid #333;
  height:56px;
  font-size:1.6rem;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.correct { background:#4caf50; border:none; }
.present { background:#fbc02d; color:black; border:none; }
.absent  { background:#555; border:none; }

.controls {
  display:flex;
  justify-content:center;
  gap:8px;
  margin-bottom:12px;
}

button {
  font-weight:bold;
  cursor:pointer;
}

#msg {
  text-align:center;
  color:#fbc02d;
  margin-bottom:10px;
  min-height:1.2em;
}

/* ‚úÖ COPY BUTTON CENTERED */
#copy {
  display:block;
  margin:8px auto 16px auto;
  width:140px;
  height:44px;
  font-size:1rem;
  border-radius:10px;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

#stats {
  margin-top:16px;
  font-size:0.95rem;
  text-align:center;
  opacity:0.9;
}

.hidden { display:none; }

/* üéâ WIN ANIMATION (1s) */
.win { animation: pop 1s ease-out; }
@keyframes pop {
  0% { transform:scale(0.9); }
  60% { transform:scale(1.1); }
  100% { transform:scale(1); }
}

/* ‚ùå LOSE ANIMATION (1s) */
.lose { animation: shake 1s; }
@keyframes shake {
  0% { transform:translateX(0); }
  25% { transform:translateX(-5px); }
  50% { transform:translateX(5px); }
  75% { transform:translateX(-5px); }
  100% { transform:translateX(0); }
}

/* QWERTY KEYBOARD */
#keyboard {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  margin-bottom:12px;
}
.keyboard-row {
  display:flex;
  gap:6px;
}
.key {
  width:32px;
  height:44px;
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:6px;
  background:#1e1e1e;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  user-select:none;
  font-size:1rem;
}
.key.correct { background:#4caf50; color:#fff; }
.key.present { background:#fbc02d; color:black; }
.key.absent { background:#555; color:#ccc; }
</style>
</head>

<body>
<div class="app">

<h1>Theme Wordle</h1>

<div class="hint">
  <div id="timerLine">Loading‚Ä¶</div>
  <div id="themeLine"></div>
</div>

<div class="board" id="board"></div>

<!-- QWERTY KEYBOARD -->
<div id="keyboard"></div>

<div id="msg"></div>

<button id="copy" class="hidden">Copy result</button>

<div id="stats">
  Played: <span id="played">0</span> ‚Ä¢
  Wins: <span id="wins">0</span> ‚Ä¢
  Win %: <span id="rate">0</span>% ‚Ä¢
  Streak: <span id="streak">0</span>
</div>

</div>

<script src="themes.js"></script>

<script>
if (!Array.isArray(WORDS) || WORDS.length === 0) {
  document.getElementById("timerLine").textContent = "ERROR: words not loaded";
  throw new Error("WORDS not loaded");
}

const now = new Date();
const intervalIndex = now.getHours() < 12 ? 0 : 1;
const dateKey = now.getFullYear()*10000 + (now.getMonth()+1)*100 + now.getDate();
const seed = dateKey*2 + intervalIndex;

function rng(seed){ let x = Math.sin(seed)*10000; return x - Math.floor(x); }

const wordObj = WORDS[Math.floor(rng(seed)*WORDS.length)];
const word = wordObj.word.toUpperCase();
const theme = wordObj.theme;

/* UI */
const timerLine = document.getElementById("timerLine");
const themeLine = document.getElementById("themeLine");
const board = document.getElementById("board");
const msg = document.getElementById("msg");
const copyBtn = document.getElementById("copy");
const app = document.querySelector(".app");
const keyboardEl = document.getElementById("keyboard");

themeLine.textContent = `HINT: ${theme} ‚Ä¢ ${word.length} letters`;

/* GAME STATE */
const maxTries = 4;
let tries = 0;
let emojis = [];
let currentGuess = "";
let usedKeys = {}; // Tracks letter states

/* STORAGE KEYS */
const gameKey = `themeWordleGame-${dateKey}-${intervalIndex}`;
const statsKey = "themeWordleStats";
const lastPlayKey = "lastPlayInterval";

/* STATS */
let stats = JSON.parse(localStorage.getItem(statsKey)) || {played:0,wins:0,streak:0};
function renderStats(){
  document.getElementById("played").textContent = stats.played;
  document.getElementById("wins").textContent = stats.wins;
  document.getElementById("streak").textContent = stats.streak;
  document.getElementById("rate").textContent = stats.played ? Math.round(stats.wins/stats.played*100) : 0;
}
renderStats();

/* BOARD */
for(let i=0;i<maxTries;i++){
  const row=document.createElement("div");
  row.className="row";
  row.style.gridTemplateColumns=`repeat(${word.length},1fr)`;
  for(let j=0;j<word.length;j++){ row.appendChild(document.createElement("div")).className="cell"; }
  board.appendChild(row);
}

/* QWERTY KEYBOARD LAYOUT */
const layout = [
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L'],
  ['Z','X','C','V','B','N','M'],
  ['ENTER','BACK']
];
layout.forEach(row=>{
  const rowEl = document.createElement("div");
  rowEl.className="keyboard-row";
  row.forEach(letter=>{
    const keyEl = document.createElement("div");
    keyEl.textContent = letter;
    keyEl.className="key";
    rowEl.appendChild(keyEl);
    keyEl.onclick = ()=>handleKey(letter);
  });
  keyboardEl.appendChild(rowEl);
});

/* KEY HANDLER */
function handleKey(key){
  if(key==="BACK"){
    currentGuess = currentGuess.slice(0,-1);
    renderCurrentGuess();
  } else if(key==="ENTER"){
    submitGuess();
  } else if(currentGuess.length < word.length){
    currentGuess += key;
    renderCurrentGuess();
  }
}

function renderCurrentGuess(){
  const row = board.children[tries];
  [...row.children].forEach((cell,i)=>{
    cell.textContent = currentGuess[i] || "";
    cell.className = "cell";
  });
}

/* SUBMIT GUESS */
function submitGuess(){
  msg.textContent = "";
  if(currentGuess.length>word.length){
    msg.textContent = "‚ö†Ô∏è Word too long!";
    return;
  }
  if(currentGuess.length!==word.length) return;

  const row=board.children[tries];
  let line=[];
  let emojiLine="";

  [...row.children].forEach((cell,i)=>{
    cell.textContent=currentGuess[i];
    if(currentGuess[i]===word[i]){
      cell.classList.add("correct"); emojiLine+="üü©";
      line.push({letter:currentGuess[i],state:"correct"});
    }else if(word.includes(currentGuess[i])){
      cell.classList.add("present"); emojiLine+="üü®";
      line.push({letter:currentGuess[i],state:"present"});
    }else{
      cell.classList.add("absent"); emojiLine+="‚¨õ";
      line.push({letter:currentGuess[i],state:"absent"});
    }
  });

  emojis.push(emojiLine);
  tries++;
  updateKeyboard(currentGuess);
  saveGame();
  currentGuess="";

  if(row.textContent===word) endGame(true);
  else if(tries===maxTries) endGame(false);
}

/* UPDATE KEYBOARD COLORS */
function updateKeyboard(guess){
  [...guess].forEach((l,i)=>{
    const state = (word[i]===l)?'correct':(word.includes(l)?'present':'absent');
    if(!usedKeys[l] || usedKeys[l]!=='correct') usedKeys[l] = state;
  });
  document.querySelectorAll("#keyboard .key").forEach(k=>{
    if(usedKeys[k.textContent]) k.className = "key " + usedKeys[k.textContent];
  });
}

/* RESTORE GAME */
const savedGame = JSON.parse(localStorage.getItem(gameKey));
if(savedGame){
  tries=savedGame.tries;
  emojis=savedGame.emojis;
  savedGame.rows.forEach((rowData,i)=>{
    const row=board.children[i];
    rowData.forEach((cell,j)=>{
      const c=row.children[j];
      c.textContent=cell.letter;
      c.classList.add(cell.state);
    });
  });
  currentGuess="";
  document.querySelectorAll("#keyboard .key").forEach(k=>{
    if(k.textContent!=="ENTER" && k.textContent!=="BACK"){
      usedKeys[k.textContent] = k.classList.contains("correct")?"correct":k.classList.contains("present")?"present":k.classList.contains("absent")?"absent":undefined;
    }
  });
  msg.textContent="üòé You've already played. Share to your friends and come back at the next word!";
}

/* SAVE GAME */
function saveGame(){
  const rows=[];
  for(let i=0;i<tries;i++){
    const row=board.children[i];
    const rowData=[...row.children].map(c=>({
      letter:c.textContent,
      state:c.classList.contains("correct")?"correct"
           :c.classList.contains("present")?"present"
           :"absent"
    }));
    rows.push(rowData);
  }
  localStorage.setItem(gameKey,JSON.stringify({tries,emojis,rows}));
}

/* END GAME */
function endGame(win){
  document.querySelectorAll(".key").forEach(k=>k.onclick=null);
  copyBtn.classList.remove("hidden");
  localStorage.setItem(lastPlayKey,`${dateKey}-${intervalIndex}`);

  stats.played++;
  if(win){
    stats.wins++;
    stats.streak++;
    msg.textContent="You win!";
    app.classList.add("win");
  }else{
    stats.streak=0;
    msg.textContent=`Word was: ${word}`;
    app.classList.add("lose");
  }
  localStorage.setItem(statsKey,JSON.stringify(stats));
  renderStats();
}

/* SHARE */
copyBtn.onclick = ()=>{
  navigator.clipboard.writeText(`Theme Wordle\n${emojis.join("\n")}\nNo spoilers`);
  msg.textContent="Copied to clipboard!";
};

/* TIMER */
function updateTimer(){
  const now=new Date();
  let next=new Date(now);
  if(now.getHours()<12) next.setHours(12,0,0,0);
  else { next.setDate(next.getDate()+1); next.setHours(0,0,0,0); }

  const diff=next-now;
  const h=String(Math.floor(diff/3600000)).padStart(2,'0');
  const m=String(Math.floor(diff%3600000/60000)).padStart(2,'0');
  const s=String(Math.floor(diff%60000/1000)).padStart(2,'0');

  timerLine.textContent=`‚è≥ Next word in ${h}:${m}:${s}`;
}
updateTimer();
setInterval(updateTimer,1000);
</script>

</body>
</html>
