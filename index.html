<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Theme Wordle</title>
<style>
  body {
    background-color: #121212;
    color: #fff;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 { margin-bottom: 10px; }
  #theme { font-weight: bold; font-size: 1.5em; margin-bottom: 10px; text-align:center; }
  #input-container { display: flex; margin-bottom: 10px; }
  #word-input { font-size: 1.3em; padding: 10px; width: 200px; border-radius: 5px; border: none; }
  #validate-btn { font-size: 1.3em; padding: 10px 15px; margin-left: 10px; cursor: pointer; border-radius:5px; border:none; background:#4caf50; color:#fff; }
  #error-msg { color: #ff4c4c; height: 1.2em; margin-bottom: 10px; text-align:center; }
  #history { display: flex; flex-direction: column; align-items: center; gap: 5px; margin-bottom: 15px; }
  .guess { font-size: 1.3em; transition: transform 0.2s; padding:2px 5px; border-radius:3px; }
  .shake { transform: translateX(5px); }
  #stats { margin-top: 15px; text-align:center; }
  #share-container { display:flex; gap:5px; margin-top:10px; flex-wrap:wrap; justify-content:center; }
  .share-link { background:#333; padding:5px 10px; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<h1>Theme Wordle</h1>
<div id="theme">Theme: ...</div>

<div id="input-container">
  <input type="text" id="word-input" placeholder="Enter word"/>
  <button id="validate-btn">Valider le mot</button>
</div>
<div id="error-msg"></div>
<div id="history"></div>

<div id="stats">
  <div>Played: <span id="played">0</span></div>
  <div>Won: <span id="won">0</span></div>
  <div>Win %: <span id="winpercent">0</span>%</div>
  <div>Win Streak: <span id="streak">0</span></div>
</div>

<div id="share-container"></div>

<script src="theme.js"></script>
<script>
const MAX_TRIES = 3;
let todayKey = new Date().toISOString().slice(0,10);
let themeKeys = Object.keys(THEMES);
let themeIndex = Math.floor(new Date().getDate() % themeKeys.length);
let theme = themeKeys[themeIndex];
let words = THEMES[theme];
let wordIndex = Math.floor(new Date().getDate() % words.length);
let wordOfDay = words[wordIndex].toUpperCase();

document.getElementById('theme').textContent = 'Theme: ' + theme;

const input = document.getElementById('word-input');
const btn = document.getElementById('validate-btn');
const errorMsg = document.getElementById('error-msg');
const history = document.getElementById('history');
const shareContainer = document.getElementById('share-container');
let tries = 0;

// Stats from localStorage
let stats = JSON.parse(localStorage.getItem('themeWordleStats')) || {played:0, won:0, streak:0};
document.getElementById('played').textContent = stats.played;
document.getElementById('won').textContent = stats.won;
document.getElementById('streak').textContent = stats.streak;
document.getElementById('winpercent').textContent = stats.played ? Math.round(stats.won / stats.played * 100) : 0;

function updateStats(win){
  stats.played++;
  if(win){
    stats.won++;
    stats.streak++;
  } else {
    stats.streak=0;
  }
  localStorage.setItem('themeWordleStats', JSON.stringify(stats));
  document.getElementById('played').textContent = stats.played;
  document.getElementById('won').textContent = stats.won;
  document.getElementById('streak').textContent = stats.streak;
  document.getElementById('winpercent').textContent = Math.round(stats.won / stats.played * 100);
}

function addGuess(text, success=false){
  const div = document.createElement('div');
  div.textContent = text.toUpperCase();
  div.className='guess';
  div.style.background=success ? '#4caf50' : '#333';
  history.appendChild(div);
  div.classList.add('shake');
  setTimeout(()=>div.classList.remove('shake'),200);
}

function copyShare(text){
  navigator.clipboard.writeText(text).then(()=>alert("Lien copié !"));
}

function shareWord(win){
  shareContainer.innerHTML='';
  const link = document.createElement('div');
  link.className='share-link';
  link.textContent='Share your result';
  link.addEventListener('click', ()=>copyShare(`I played Theme Wordle today! Can you guess the word?`));
  shareContainer.appendChild(link);
}

function validateWord(){
  let guess = input.value.trim().toUpperCase();
  if(!guess) return;
  if(!words.includes(guess)){
    errorMsg.textContent='Mot invalide !';
    return;
  }
  errorMsg.textContent='';
  addGuess(guess, guess===wordOfDay);
  tries++;
  if(guess===wordOfDay){
    alert('Bravo ! Mot trouvé.');
    input.disabled=true;
    btn.disabled=true;
    updateStats(true);
    shareWord(true);
  } else if(tries>=MAX_TRIES){
    alert('Échec ! Le mot était : ' + wordOfDay);
    input.disabled=true;
    btn.disabled=true;
    updateStats(false);
    shareWord(false);
  }
  input.value='';
}

btn.addEventListener('click', validateWord);
input.addEventListener('keypress', (e)=>{if(e.key==='Enter') validateWord();});
</script>
</body>
</html>
