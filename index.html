<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Theme Wordle</title>

<style>
body {
  background:#121212;
  color:#fff;
  font-family:system-ui;
  margin:0;
  padding:16px;
}
.app {
  max-width:420px;
  margin:auto;
  text-align:center;
}
h1 { text-align:center; margin-bottom:8px; }

.hint {
  background:#1e1e1e;
  padding:14px;
  border-radius:10px;
  text-align:center;
  margin-bottom:16px;
  font-size:1.1rem;
}

.board {
  display:grid;
  gap:10px;
  margin-bottom:16px;
}
.row {
  display:grid;
  gap:8px;
}
.cell {
  background:#1e1e1e;
  border:2px solid #333;
  height:56px;
  font-size:1.6rem;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  transition: transform 0.2s;
}

.correct { background:#4caf50; border:none; }
.present { background:#fbc02d; color:black; border:none; }
.absent  { background:#555; border:none; }

input, button {
  height:50px;
  font-size:1.2rem;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
  display:inline-block;
  vertical-align:middle;
}
input.error { background:#3a1515; border:2px solid #ff5252; color:#ffb3b3; }

button {
  font-weight:bold;
  cursor:pointer;
}

#input, #validate { width:48%; }

#msg {
  text-align:center;
  color:#fbc02d;
  margin-bottom:10px;
  min-height:1.2em;
}

#stats {
  margin-top:16px;
  font-size:0.95rem;
  text-align:center;
  opacity:0.9;
}

.hidden { display:none; }

#try-counter {
  margin-bottom:10px;
  font-size:1rem;
  color:#aaa;
  transition: transform 0.2s;
}

#timer {
  margin-top:10px;
}
</style>
</head>

<body>
<div class="app">

<h1>Theme Wordle</h1>

<div class="hint" id="hint">Loadingâ€¦</div>
<div id="try-counter"></div>

<div class="board" id="board"></div>

<input id="input" placeholder="Type your word" />
<button id="validate">Validate</button>

<div id="msg"></div>

<button id="copy" class="hidden">Copy result</button>

<div id="stats">
  Played: <span id="played">0</span> â€¢
  Wins: <span id="wins">0</span> â€¢
  Win %: <span id="rate">0</span>% â€¢
  Streak: <span id="streak">0</span>
</div>

<div id="timer" class="hint hidden"></div>

</div>

<script src="themes.js"></script>

<script>
if (!Array.isArray(WORDS) || WORDS.length === 0) {
  document.getElementById("hint").textContent = "ERROR: words not loaded";
  throw new Error("WORDS not loaded");
}

function getDailyWord() {
  const now = new Date();
  const hours = now.getUTCHours();
  const slot = hours >= 12 ? 1 : 0;
  const daySeed = Math.floor(now.getTime() / 86400000) * 2 + slot;

  const recent = JSON.parse(localStorage.getItem("themeWordleRecent")) || [];
  let index;
  let tries = 0;

  do {
    index = Math.floor(Math.random() * WORDS.length);
    tries++;
    if (tries > 100) break;
  } while (recent.slice(-30).includes(index));

  recent.push(index);
  if (recent.length > 30) recent.splice(0, recent.length - 30);
  localStorage.setItem("themeWordleRecent", JSON.stringify(recent));

  return WORDS[index];
}

const daily = getDailyWord();
const word = daily.word.toUpperCase();
const theme = daily.theme;

/* ---------- UI ---------- */
const hint = document.getElementById("hint");
const board = document.getElementById("board");
const input = document.getElementById("input");
const validate = document.getElementById("validate");
const msg = document.getElementById("msg");
const copyBtn = document.getElementById("copy");
const timerEl = document.getElementById("timer");
const tryCounter = document.getElementById("try-counter");

hint.textContent = `HINT: ${theme} â€¢ ${word.length} letters`;

/* ---------- GAME STATE ---------- */
const maxTries = 4;
let tries = 0;
let emojis = [];

/* ---------- BOARD ---------- */
for (let i = 0; i < maxTries; i++) {
  const row = document.createElement("div");
  row.className = "row";
  row.style.gridTemplateColumns = `repeat(${word.length},1fr)`;
  for (let j = 0; j < word.length; j++) {
    row.appendChild(document.createElement("div")).className = "cell";
  }
  board.appendChild(row);
}

function updateTryCounter() {
  tryCounter.textContent = `Try ${tries + 1} / ${maxTries}`;
}
updateTryCounter();

/* ---------- STATS ---------- */
const statsKey = "themeWordleStats";
let stats = JSON.parse(localStorage.getItem(statsKey)) || {
  played:0, wins:0, streak:0
};

function renderStats(){
  document.getElementById("played").textContent = stats.played;
  document.getElementById("wins").textContent = stats.wins;
  document.getElementById("streak").textContent = stats.streak;
  document.getElementById("rate").textContent =
    stats.played ? Math.round(stats.wins / stats.played * 100) : 0;
}
renderStats();

/* ---------- CHECK IF ALREADY PLAYED ---------- */
const lastPlay = localStorage.getItem("themeWordleLastPlay");
const nowTime = Date.now();
if (lastPlay && nowTime - lastPlay < 12*60*60*1000) {
  const remaining = 12*60*60*1000 - (nowTime - lastPlay);
  input.disabled = true;
  validate.disabled = true;
  timerEl.classList.remove("hidden");
  timerEl.textContent = `ðŸ˜Ž You already played today. Come back in ${Math.floor(remaining/3600000)}h ${Math.floor((remaining%3600000)/60000)}m`;
}

/* ---------- HELPERS ---------- */
function showTimer() {
  if (input.disabled) {
    const remaining = 12*60*60*1000 - (Date.now() - lastPlay);
    if (remaining <= 0) location.reload();
    timerEl.textContent = `ðŸ˜Ž You already played today. Come back in ${Math.floor(remaining/3600000)}h ${Math.floor((remaining%3600000)/60000)}m`;
    setTimeout(showTimer, 1000);
  }
}
showTimer();

/* ---------- VALIDATE ---------- */
validate.onclick = () => {
  input.classList.remove("error","correct");
  msg.textContent = "";

  const guess = input.value.toUpperCase().trim();
  if (guess.length !== word.length) {
    msg.textContent = "Wrong length";
    return;
  }

  const row = board.children[tries];

  [...row.children].forEach((cell,i)=>{
    cell.textContent = guess[i];
    if (guess[i] === word[i]) {
      cell.classList.add("correct");
      cell.style.transform = "scale(1.2)";
      setTimeout(()=>cell.style.transform="scale(1)",200);
    } else if (word.includes(guess[i])) {
      cell.classList.add("present");
      cell.style.transform = "scale(1.2)";
      setTimeout(()=>cell.style.transform="scale(1)",200);
    } else {
      cell.classList.add("absent");
      cell.style.transform = "scale(1.2)";
      setTimeout(()=>cell.style.transform="scale(1)",200);
    }
  });

  if (guess === word) {
    input.classList.add("correct");
  } else {
    input.classList.add("error");
  }

  let line = "";
  [...row.children].forEach((cell,i)=>{
    if (cell.classList.contains("correct")) line+="ðŸŸ©";
    else if (cell.classList.contains("present")) line+="ðŸŸ¨";
    else line+="â¬›";
  });
  emojis.push(line);
  tries++;
  input.value = "";
  updateTryCounter();

  if (guess === word) endGame(true);
  else if (tries === maxTries) endGame(false);
};

/* ---------- END GAME ---------- */
function endGame(win){
  input.disabled = true;
  validate.disabled = true;
  copyBtn.classList.remove("hidden");
  localStorage.setItem("themeWordleLastPlay", Date.now());

  stats.played++;
  if (win) {
    stats.wins++;
    stats.streak++;
    msg.textContent = "You win!";
  } else {
    stats.streak = 0;
    msg.textContent = `Word was: ${word}`;
  }

  localStorage.setItem(statsKey, JSON.stringify(stats));
  renderStats();
}

/* ---------- SHARE ---------- */
copyBtn.onclick = () => {
  navigator.clipboard.writeText(
    `Theme Wordle\n${emojis.join("\n")}`
  );
  msg.textContent = "Copied to clipboard!";
};
</script>

</body>
</html>
