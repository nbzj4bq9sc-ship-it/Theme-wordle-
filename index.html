<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Theme Wordle</title>
<style>
body {
  background-color: #121212;
  color: #fff;
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}
h1 { margin-bottom: 10px; }
#theme { font-weight: bold; font-size: 1.5em; margin-bottom: 15px; text-align:center; }
#input-container { display:flex; margin-bottom:10px; }
#word-input { font-size:1.3em; padding:10px; width:200px; border-radius:5px; border:none; transition:border 0.3s; }
#word-input.invalid { border: 2px solid #ff4c4c; }
#validate-btn { font-size:1.3em; padding:10px 15px; margin-left:10px; cursor:pointer; border-radius:5px; border:none; background:#4caf50; color:#fff; }
#error-msg { color:#ff4c4c; height:1.2em; margin-bottom:10px; text-align:center; }
#history { display:flex; flex-direction:column; gap:5px; margin-bottom:15px; }
.row { display:flex; gap:5px; justify-content:center; }
.letter {
  display:inline-block;
  width:35px;
  height:35px;
  line-height:35px;
  text-align:center;
  font-weight:bold;
  font-size:1.2em;
  border:2px solid #555;
  border-radius:4px;
  transition: transform 0.2s;
}
.correct { background-color:#4caf50; color:#fff; border:none; }
.present { background-color:#ffeb3b; color:#000; border:none; }
.absent { background-color:#333; color:#fff; border:none; }
.shake { transform:translateX(5px); }
#stats { margin-top:15px; text-align:center; }
#share-container { display:flex; gap:5px; margin-top:10px; flex-wrap:wrap; justify-content:center; }
.share-link { background:#333; padding:5px 10px; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<h1>Theme Wordle</h1>
<div id="theme">Theme: ...</div>

<div id="input-container">
  <input type="text" id="word-input" placeholder="Enter word"/>
  <button id="validate-btn">Valider le mot</button>
</div>
<div id="error-msg"></div>
<div id="history"></div>

<div id="stats">
  <div>Played: <span id="played">0</span></div>
  <div>Won: <span id="won">0</span></div>
  <div>Win %: <span id="winpercent">0</span>%</div>
  <div>Win Streak: <span id="streak">0</span></div>
</div>

<div id="share-container"></div>

<script src="theme.js"></script>
<script>
const MAX_TRIES = 3;

// ----- Sélection du thème et mot du jour -----
let todayKey = new Date().toISOString().slice(0,10);
let themeKeys = Object.keys(THEMES);
let themeIndex = new Date().getDate() % themeKeys.length;
let theme = themeKeys[themeIndex];
let words = THEMES[theme].map(w=>w.toUpperCase());
let wordIndex = new Date().getDate() % words.length;
let wordOfDay = words[wordIndex];

// Set global pour validation stricte
const ALL_WORDS = new Set([].concat(...Object.values(THEMES)).map(w=>w.toUpperCase()));

document.getElementById('theme').textContent = 'Theme: ' + theme;

// ----- DOM -----
const input = document.getElementById('word-input');
const btn = document.getElementById('validate-btn');
const errorMsg = document.getElementById('error-msg');
const history = document.getElementById('history');
const shareContainer = document.getElementById('share-container');
let tries = 0;

// ----- Stats -----
let stats = JSON.parse(localStorage.getItem('themeWordleStats')) || {played:0, won:0, streak:0};
function updateStatsDisplay(){
  document.getElementById('played').textContent = stats.played;
  document.getElementById('won').textContent = stats.won;
  document.getElementById('streak').textContent = stats.streak;
  document.getElementById('winpercent').textContent = stats.played ? Math.round(stats.won/stats.played*100) : 0;
}
updateStatsDisplay();

function updateStats(win){
  stats.played++;
  if(win){ stats.won++; stats.streak++; } 
  else stats.streak=0;
  localStorage.setItem('themeWordleStats', JSON.stringify(stats));
  updateStatsDisplay();
}

// ----- Affichage lettre par lettre avec suspense -----
function displayGuess(guess){
  const row = document.createElement('div');
  row.className='row';
  history.appendChild(row);
  
  guess.split('').forEach((letter, i)=>{
    setTimeout(()=>{
      const span=document.createElement('div');
      span.className='letter';
      span.textContent=letter;
      if(wordOfDay[i]===letter) span.classList.add('correct');
      else if(wordOfDay.includes(letter)) span.classList.add('present');
      else span.classList.add('absent');
      row.appendChild(span);
      row.classList.add('shake');
      setTimeout(()=>row.classList.remove('shake'),200);
    }, i*600);
  });
}

// ----- Partage -----
function copyShare(text){ navigator.clipboard.writeText(text).then(()=>alert("Lien copié !")); }
function shareWord(){
  shareContainer.innerHTML='';
  const link=document.createElement('div');
  link.className='share-link';
  link.textContent='Share your result';
  link.addEventListener('click', ()=>copyShare(`I played Theme Wordle today! Can you guess the word?`));
  shareContainer.appendChild(link);
}

// ----- Validation -----
function validateWord(){
  let guess = input.value.trim().toUpperCase();
  if(!guess) return;

  // Validation stricte
  if(!ALL_WORDS.has(guess)){
    errorMsg.textContent='Mot invalide !';
    input.classList.add('invalid');
    return;
  }

  input.classList.remove('invalid');
  errorMsg.textContent='';

  displayGuess(guess);
  tries++;

  const delay = guess.length*600 + 100;

  if(guess === wordOfDay){
    setTimeout(()=>{
      alert('Bravo ! Mot trouvé.');
      input.disabled=true; btn.disabled=true;
      updateStats(true);
      shareWord();
    }, delay);
  } else if(tries >= MAX_TRIES){
    setTimeout(()=>{
      alert('Échec ! Le mot était : '+wordOfDay);
      input.disabled=true; btn.disabled=true;
      updateStats(false);
      shareWord();
    }, delay);
  }

  updateStatsDisplay(); // mise à jour stats immédiatement
  input.value='';
}

// ----- Events -----
btn.addEventListener('click', validateWord);
input.addEventListener('keypress', (e)=>{ if(e.key==='Enter') validateWord(); });
</script>
</body>
</html>
